app.controller("ctrl_veriation",(function($scope,$http){let project_id;function get_projectinfo(){let post_data={naf_user:userinfo,project_no:project_id};var req;$http.post(api_url+"Project/view.php",post_data).then(res=>{if("1"===res.data.msg){var d,y=(new Date).getFullYear().toString(),yp=y.substr(y.length-1);console.log(yp),$scope.viewproject=res.data.data,$scope.newproject=res.data.data,project_id=angular.lowercase(res.data.data.project_no),console.log(res.data.data.project_no),$scope.newvariations={variation_project_code:res.data.data.project_no,variation_project_name:res.data.data.project_name,variation_project_location:res.data.data.project_location,variation_refno_p1:"NAF/CD",variation_refno_p2:"03",variation_refno_p4:y},ListVariations()}else alert(res.data.data)})}function all_techApprovalsType(){let post_data={naf_user:userinfo};$http({method:"post",data:post_data,url:api_url+"Approval_Type/index.php"}).then((function(res){"1"===res.data.msg?$scope.menu_Techapprovals=res.data.data:alert(res.data.data)}))}function allregion(){$scope.src_region=[],$scope.listregion=[];let post_data={naf_user:userinfo};$http({method:"post",data:post_data,url:api_url+"regions/index.php"}).then(res=>{"1"===res.data.msg?($scope.src_region=res.data.data,$scope.listregion=res.data.data):alert(res.data.data)})}function allsalesman(){$scope.src_salesman=[],$scope.salesmanlist=[];let post_data={naf_user:userinfo};$http({method:"post",data:post_data,url:api_url+"SalesMan/index.php"}).then((function(res){"1"===res.data.msg?($scope.src_salesman=res.data.data,$scope.salesmanlist=res.data.data):alert(res.data.data)}))}function allsubjects(){$scope.subjectlist=[],$scope.src_subjectlist=[];let post_data={naf_user:userinfo};$http.post(api_url+"variationsubjects/index.php",post_data).then(res=>{"1"===res.data.msg?($scope.sublist123=res.data.data,$scope.src_subjectlist=res.data.data):alert(res.data.data)})}function ListVariations(){let post_data={naf_user:userinfo,project_no:project_id};$http({method:"post",data:post_data,url:api_url+"Variations/index.php"}).then((function(res){"1"===res.data.msg?$scope.variationslist=res.data.data:alert(res.data.data)}))}$("#back_btn").on("click",(function(){window.history.back()})),sessionStorage.getItem("nafco_project_current")&&""!==sessionStorage.getItem("nafco_project_current")?(project_id=sessionStorage.getItem("nafco_project_current"),get_projectinfo()):projectlist(),all_techApprovalsType(),allregion(),allsalesman(),allsubjects(),$scope.region_new_save=function(){var post_data={naf_user:userinfo,region_name:$scope.addnewregionname};$http({method:"post",data:post_data,url:api_url+"regions/new.php"}).then((function(res){"1"===res.data.msg?(alert("saved"),allregion(),$scope.addnewregionname=""):alert(res.data.data)}))},$scope.subjectname_new_save=function(){var post_data={naf_user:userinfo,subject_name:$scope.addnewsubjectname};$http({method:"post",data:post_data,url:api_url+"variationsubjects/new.php"}).then(res=>{"1"===res.data.msg?(alert("saved"),allsubjects(),$scope.addnewsubjectname="",document.getElementById("addnewsubjectname").focus()):alert(res.data.data)})},$scope.salesman_new_save=function(){let post_data={naf_user:userinfo,sales_code:$scope.addsalesmancode,sales_name:$scope.addsalesmanname};$http({method:"post",data:post_data,url:api_url+"SalesMan/new.php"}).then((function(res){"1"===res.data.msg?(alert("Saved"),allsalesman(),$scope.addsalesmancode="",$scope.addsalesmanname="",document.getElementById("addsalesmancode").focus()):alert(res.data.data)}))},$scope.refnojoin=function($event){if($scope.newvariations.variation_refno_p1&&$scope.newvariations.variation_refno_p2&&$scope.newvariations.variation_refno_p3&&$scope.newvariations.variation_refno_p4){var _refno=$scope.newvariations.variation_refno_p1+"/"+$scope.newvariations.variation_refno_p2+"-"+$scope.newvariations.variation_refno_p3+"/"+$scope.newvariations.variation_refno_p4;$scope.newvariations.variation_refno=_refno}else $scope.newvariations.variation_refno=""},$scope.GetOldinfo=function(){if($scope.newvariations.variation_refno_p3&&""!==$scope.newvariations.variation_refno_p3){let post_data={naf_user:userinfo,project_no:project_id,p3:$scope.newvariations.variation_refno_p3};$http({method:"post",data:post_data,url:api_url+"Variations/getp3.php"}).then((function(res){"1"===res.data.msg&&confirm("Already Data found, Do you Want Load Previous Data?")&&($scope.newvariations=res.data.data)}))}else;},$("#save_new_variations").submit((function(e){e.preventDefault();var fd=new FormData(this);fd.append("user_name",userinfo.user_name),fd.append("user_token",userinfo.user_token),$.ajax({url:api_url+"Variations/new.php",data:fd,method:"post",cache:!1,contentType:!1,processData:!1,success:function(res){"1"===res.msg?(alert("saved"),location.reload()):alert(res.data)}})})),$scope.variationslist=[],$scope.edit_windows=function(v){document.getElementById("edit-glassorder").style.display="block",$scope.editvariations=v},$scope.status_change=function(itstoken){console.log(itstoken),document.getElementById("change-status").style.display="block",$scope.changestatus={variation_token:itstoken}},$("#status_change_frm").submit((function(e){e.preventDefault();var fd=new FormData(this);fd.append("user_name",userinfo.user_name),fd.append("user_token",userinfo.user_token),$.ajax({url:api_url+"Variations/statuschange.php",data:fd,method:"post",cache:!1,contentType:!1,processData:!1,success:function(res){"1"===res.msg?(alert("saved"),location.reload()):alert(res.data)}})})),$("#edit_new_variations").submit((function(e){e.preventDefault();var fd=new FormData(this);fd.append("user_name",userinfo.user_name),fd.append("user_token",userinfo.user_token),$.ajax({url:api_url+"Variations/edit.php",data:fd,method:"post",cache:!1,contentType:!1,processData:!1,success:function(res){console.log(res),"1"===res.msg?(alert("saved"),location.reload()):alert(res.data)}})}))}));